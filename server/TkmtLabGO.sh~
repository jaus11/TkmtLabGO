#! /bin/bash                                                                                                       
set -eu

date "+%Y/%m/%d-%H:%M:%S"
cd /Users/rails/Work/TkmtLabGO
echo "dir changed"
git pull origin master
echo "git pull"
git fetch origin --prune
echo "git fetch"
if [ "$(git rev-parse origin/master)" != "$(git rev-parse master)" ]; then    
/usr/local/bin/docker-compose -f /Users/rails/Work/TkmtLabGO/docker/docker-compose.yml down
echo "docker-compose down"
docker network rm $(docker network ls -q) || true
echo "docker network rm"
/usr/local/bin/docker-compose -f /Users/rails/Work/TkmtLabGO/docker/docker-compose.yml build --no-cache
echo "docker-compose build"
/usr/local/bin/docker-compose -f /Users/rails/Work/TkmtLabGO/docker/docker-compose.yml up
echo "docker-compose up"
else
echo "not changed"
fi 
